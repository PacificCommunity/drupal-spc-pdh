(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{182:function(e,t,a){e.exports=a(445)},443:function(e,t,a){},445:function(e,t,a){"use strict";a.r(t);a(183);var n=a(0),r=a.n(n),s=a(50),c=a.n(s),l=a(33),i=a(34),o=a(37),u=a(35),p=a(36),d=a(8),h=a(25),f="GET_CONFIG",m="GET_FACETS",g="GET_LOADING_DATA_REQUEST",b="GET_DATA_REQUEST",y="GET_SEARCH_TEXT",v="GET_FILTERS";function E(e){return{type:m,payload:{search_facets:e}}}var _=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).searchInput=r.a.createRef(),a.search=a.search.bind(Object(d.a)(Object(d.a)(a))),a.searchOnKeyPress=a.searchOnKeyPress.bind(Object(d.a)(Object(d.a)(a))),a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"search",value:function(){this.props.getSearchTextAction(this.searchInput.current.value),this.props.searchForData(this.searchInput.current.value,this.props.filters.filters)}},{key:"searchOnKeyPress",value:function(e){13===e.keyCode&&(this.props.getSearchTextAction(this.searchInput.current.value),this.props.searchForData(this.searchInput.current.value,this.props.filters.filters))}},{key:"render",value:function(){return r.a.createElement("div",{className:"search-block"},r.a.createElement("input",{type:"text",placeholder:"Enter key words...",ref:this.searchInput,onKeyDown:this.searchOnKeyPress,className:this.props.data.is_loading?"disabled":""}),r.a.createElement("button",{onClick:this.search,className:"search-btn ".concat(this.props.data.is_loading?"disabled":"")},this.props.data.is_loading?r.a.createElement(r.a.Fragment,null,"Searching",r.a.createElement("div",{className:"lds-spinner"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))):r.a.createElement(r.a.Fragment,null,"Search")))}}]),t}(r.a.Component),O=Object(h.b)(function(e){return{data:e.data,filters:e.filters}},function(e){return{getSearchTextAction:function(t){return e(function(e){return{type:y,payload:{text:e}}}(t))}}})(_),j=a(181),k=a(173),C=a.n(k),N=a(174),F=a(38),D=a(175),w=a.n(D),A=function(e){var t=e.item,a=e.portals;return r.a.createElement("div",{className:"result-item"},r.a.createElement("h3",null,r.a.createElement("a",{href:void 0!==t.organization?a.ckan+"/dataset/"+t.id:a.drupal+"/node/"+t.id},t.title)),r.a.createElement("p",{className:"result-date"},t.thematic_area_string[0]?r.a.createElement("span",{className:"topic-title"},t.thematic_area_string.join(", ")):"",r.a.createElement(C.a,{format:"D MMMM YYYY"},t.metadata_modified)),void 0!==t.five_star_rating&&0!==t.five_star_rating?r.a.createElement("span",{className:"star-rating"},Object(j.a)(Array(t.five_star_rating).keys()).map(function(e){return r.a.createElement(F.a,{icon:"star",key:"star-".concat(e+1)})})):"",r.a.createElement("span",{className:"result-type"}," ",t.type.replace("_"," ")),r.a.createElement("p",{className:"note"},r.a.createElement(N.a,{lines:3,ellipsis:"..."},w()(t.notes))),t.resources?r.a.createElement("div",{className:"resources-list"},t.resources.map(function(e){return r.a.createElement("span",{className:"resource",key:e.id},""!==e.format?e.format:"DATA")})):"")},S=a(72),R=a(176),x=a.n(R),T=function(e){return S.a.DropdownIndicator&&r.a.createElement(S.a.DropdownIndicator,e,r.a.createElement(F.a,{icon:e.selectProps.menuIsOpen?"caret-up":"caret-down"}))},I=function(e){return r.a.createElement(S.a.MultiValueLabel,e,r.a.createElement("div",{className:"value-tooltip-wrapper","data-tip":e.data.labelNoCount},e.data.labelNoCount),r.a.createElement(x.a,null))},P=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={options:[],selectedOption:null},a.handleChange=a.handleChange.bind(Object(d.a)(Object(d.a)(a))),a.getFilterOptions=a.getFilterOptions.bind(Object(d.a)(Object(d.a)(a))),a.facets_labels={language:"Select a language",license_id:"Select a license",member_countries:"Select a member country",organization:"Select an organisation",res_format:"Select a format",tags:"Select a tag",topic:"Select a topic",type:"Select a type"},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.getFilterOptions()}},{key:"componentDidUpdate",value:function(e){this.props.facets.search_facets!==e.facets.search_facets&&this.getFilterOptions()}},{key:"getFilterOptions",value:function(){var e=this.props.config.config_data,t=this.props.facet_key,a=[];this.props.facets.search_facets[t].items.forEach(function(n){if(void 0!==e.mapping&&void 0!==e.mapping[t]){var r=e.mapping[t];a.push({value:n.name,label:r[n.name]+" ("+n.count+")",count:n.count,labelNoCount:n.display_name})}else a.push({value:n.name,label:n.display_name+" ("+n.count+")",count:n.count,labelNoCount:n.display_name})}),a.sort(function(e,t){return t.count-e.count}),this.setState({options:a})}},{key:"handleChange",value:function(e){this.props.get_filters(this.props.facet_key,e),this.setState({selectedOption:e})}},{key:"render",value:function(){return r.a.createElement(S.b,{value:this.state.selectedOption,onChange:this.handleChange,options:this.state.options,placeholder:this.facets_labels[this.props.facet_key],isMulti:!0,closeMenuOnSelect:!0,className:"filter-select ".concat(this.props.data.is_loading||"language"===this.props.facet_key?"disabled":""),classNamePrefix:"filter",components:{DropdownIndicator:T,MultiValueLabel:I}})}}]),t}(r.a.Component),M=Object(h.b)(function(e){return{data:e.data,facets:e.facets,config:e.config}},function(e){return{getFacetsAction:function(t){return e(E(t))}}})(P),L=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).get_filters=a.get_filters.bind(Object(d.a)(Object(d.a)(a))),a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.config.config_data!==e.config.config_data&&this.props.searchForData("",null,!0)}},{key:"get_filters",value:function(e,t){var a=this.props.filters.filters;0!==t.length?a[e]=t:void 0!==a[e]&&delete a[e],this.props.getFiltersAction(a),(Object.keys(a).length>0||0===Object.keys(a).length&&void 0!==this.props.data.text)&&this.props.searchForData(this.props.data.text,a),0!==Object.keys(a).length||""!==this.props.data.text&&void 0!==this.props.data.text||this.props.searchForData("",null,!0)}},{key:"render",value:function(){var e=this,t=this.props.facets;return r.a.createElement("div",{className:"filter-block"},r.a.createElement("p",null,"Filter your search"),r.a.createElement("div",{className:"advanced-search-filters"},Object.keys(t).map(function(t){return r.a.createElement(M,{facet_key:t,get_filters:e.get_filters,key:t})})))}}]),t}(r.a.Component),U=Object(h.b)(function(e){return{config:e.config,facets:e.facets.search_facets,data:e.data,filters:e.filters}},function(e){return{getFiltersAction:function(t){return e({type:v,payload:{filters:t}})}}})(L),G=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={currentPage:1},a.getRenderResults=a.getRenderResults.bind(Object(d.a)(Object(d.a)(a))),a.getPagination=a.getPagination.bind(Object(d.a)(Object(d.a)(a))),a.handleClick=a.handleClick.bind(Object(d.a)(Object(d.a)(a))),a.data_types={geographic_data:{single:"geographic data item",multiple:"geographic data items"},biodiversity_data:{single:"biodiversity data item",multiple:"biodiversity data items"},publications:{single:"publication",multiple:"publications"},dataset:{single:"dataset",multiple:"datasets"},story:{single:"story",multiple:"stories"}},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.results!==e.results&&this.setState({currentPage:1})}},{key:"getRenderResults",value:function(){var e=this,t=this.props.config.config_data.results_per_page,a=this.state.currentPage*t,n=a-t;return this.props.results.results.slice(n,a).map(function(t){return r.a.createElement(A,{item:t,key:t.id,portals:e.props.portals})})}},{key:"getPagination",value:function(){var e=this.props.config.config_data.results_per_page,t=parseInt(Math.ceil(this.props.results.count/e),10),a=this.state.currentPage;return r.a.createElement("ul",{className:"search-pagination"},a>1?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{onClick:this.handleClick,page:"1"},r.a.createElement(F.a,{icon:"angle-double-left"})),r.a.createElement("li",{onClick:this.handleClick,page:a-1},r.a.createElement(F.a,{icon:"angle-left"})),r.a.createElement("li",{onClick:this.handleClick,page:a-1},a-1)):r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:"disabled"},r.a.createElement(F.a,{icon:"angle-left"}))),r.a.createElement("li",{className:"active",onClick:this.handleClick,page:a},a),t-a>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{onClick:this.handleClick,page:a+1},a+1),t>a+1&&r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:"disabled"},"..."),r.a.createElement("li",{onClick:this.handleClick,page:t},t)),r.a.createElement("li",{onClick:this.handleClick,page:a+1},r.a.createElement(F.a,{icon:"angle-right"})),r.a.createElement("li",{onClick:this.handleClick,page:t},r.a.createElement(F.a,{icon:"angle-double-right"}))))}},{key:"handleClick",value:function(e){this.setState({currentPage:parseInt(e.target.getAttribute("page"),10)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"results-list"},this.props.results&&this.props.results.results?this.props.results.count>0?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},this.props.results.count," Results Found"),this.props.results.types_count?Object.keys(this.props.results.types_count).map(function(t,a){return r.a.createElement("span",{key:t},e.props.results.types_count[t]," ",e.props.results.types_count[t]>1?e.data_types[t].multiple:e.data_types[t].single,Object.keys(e.props.results.types_count).length-1>a?", ":"")}):""),r.a.createElement("div",{className:"result-content datasets-list"},this.getRenderResults(),this.props.results.count>this.props.config.config_data.results_per_page?this.getPagination():"")):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},"No Results Found"),r.a.createElement("p",{className:"small"},"Sorry, we couldn\u2019t found any results matching your search")),r.a.createElement("div",{className:"result-content"},r.a.createElement("p",null,"Suggestions:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Make sure all words are spelled correctly"),r.a.createElement("li",null,"Try a similar but different search term"),r.a.createElement("li",null,"The filter combination may return zero results, you may have to try a different search scope")))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},"What are you looking for?")),r.a.createElement("div",{className:"result-content"},r.a.createElement("ul",null,r.a.createElement("li",null,"Start your search by typing one or more keywords into the search box"),r.a.createElement("li",null,"Using general search terms will get more search results, or use exact phrases to narrow down your search"),r.a.createElement("li",null,"For more specific results, make use of the filters to limit your search scope")))))}}]),t}(r.a.Component),K=Object(h.b)(function(e){return{config:e.config}})(G),q=a(71),z=a.n(q),Y=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).getResponseData=a.getResponseData.bind(Object(d.a)(Object(d.a)(a))),a.searchForData=a.searchForData.bind(Object(d.a)(Object(d.a)(a))),a.portalsUrls={},a}return Object(p.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this,t=window.advanced_search_conf_url?window.advanced_search_conf_url:"";z.a.get(t+"/configs/config.json").then(function(t){e.props.getConfigAction(t.data)}).catch(function(e){console.log(e)})}},{key:"getResponseData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[],n=0,r={},s=0,c={},l={items:[],title:"topic"},i={};if(e.forEach(function(e){if(Object.keys(e.data.result.search_facets).forEach(function(t){"topic"===t?e.data.result.search_facets[t].items.forEach(function(e){void 0===i[e.name]?i[e.name]=e:i[e.name].count=i[e.name].count+e.count}):c[t]=e.data.result.search_facets[t]}),!0!==t&&e.data.result&&(a=a.concat(e.data.result.results),n+=e.data.result.count,e.data.result.types_count&&void 0!==e.data.result.types_count))if(r=e.data.result.types_count,Object.keys(r).length>1)s=Object.values(r).reduce(function(e,t){return e+t});else{var l=Object.keys(r)[0];s=r[l]}}),Object.keys(i).forEach(function(e){l.items.push(i[e])}),c.topic=l,Object.keys(c).length>0){var o={};Object.keys(c).sort().forEach(function(e){o[e]=c[e]}),this.props.getFacetsAction(o)}var u=n-s;return u>0&&(r.story=u),{count:n,results:!0===t?null:a,types_count:r}}},{key:"searchForData",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.props.isLoadingAction(!0);var r="";a&&Object.keys(a).forEach(function(e){var t=[];a[e].forEach(function(e){t.push(e.value)}),t.length>1?(t.forEach(function(a,n){t[n]=e+":"+a}),r+=t.join('", "')+" "):r+=e+':"'+t[0]+'"'});var s=this.props.config.config_data;z.a.all(s.portals.map(function(s){t.portalsUrls[s.portal]=s.url;var c={};return"ckan"===s.portal.toLowerCase()?(c["facet.field"]='["organization", "tags", "res_format", "license_id", "type", "member_countries", "topic", "language"]',""!==e&&(c.q=e),""!==r&&(c.fq=r),!0===n&&(c.rows=0)):"drupal"===s.portal.toLowerCase()&&(c.topic="",a&&((Object.keys(a).length>1||1===Object.keys(a).length&&(void 0===a.topic||a.topic.length>1))&&(c.disabled=!0),1===Object.keys(a).length&&void 0!==a.topic&&1===a.topic.length&&(""!==e&&(c.query=e),c.topic=a.topic[0].value),0===Object.keys(a).length&&""!==e&&(c.query=e))),z.a.get(s.url+s.endpoint,{params:c})})).then(z.a.spread(function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return t.getResponseData(a,n)})).catch(function(e){console.log(e),t.props.isLoadingAction(!1)}).then(function(a){t.props.getDataAction(e,a)})}},{key:"render",value:function(){return r.a.createElement("div",{className:"advanced-search"},r.a.createElement(O,{searchForData:this.searchForData}),r.a.createElement(U,{searchForData:this.searchForData,getResponseData:this.getResponseData}),r.a.createElement(K,{results:this.props.data.data,portals:this.portalsUrls}))}}]),t}(n.Component),B=Object(h.b)(function(e){return{data:e.data,config:e.config,facets:e.facets}},function(e){return{getConfigAction:function(t){return e(function(e){return{type:f,payload:{config_data:e}}}(t))},getFacetsAction:function(t){return e(E(t))},isLoadingAction:function(t){return e({type:g,payload:{text:t}})},getDataAction:function(t,a){return e(function(e,t){return{type:b,payload:{text:e,data:t}}}(t,a))}}})(Y),J=a(63),Q=a(59),V={config_data:{}},W={search_facets:{}},H={text:"",is_loading:!1,data:null},X={filters:{}};var Z=Object(J.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(Q.a)({},e,{config_data:t.payload.config_data});default:return e}},facets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return Object(Q.a)({},e,{search_facets:t.payload.search_facets});default:return e}},data:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(Q.a)({},e,{text:t.payload.text,is_loading:!1,data:t.payload.data});case g:return Object(Q.a)({},e,{is_loading:!0});case y:return Object(Q.a)({},e,{text:t.payload.text});default:return e}},filters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return Object(Q.a)({},e,{filters:t.payload.filters});default:return e}}}),$=Object(J.c)(Z),ee=(a(443),a(70)),te=a(51);ee.b.add([te.g,te.e,te.f,te.a,te.c,te.d,te.b]),document.getElementById("advanced-search-application")&&c.a.render(r.a.createElement(h.a,{store:$},r.a.createElement(B,null)),document.getElementById("advanced-search-application"))}},[[182,2,1]]]);
