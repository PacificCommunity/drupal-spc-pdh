(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{179:function(e,t,a){e.exports=a(430)},428:function(e,t,a){},430:function(e,t,a){"use strict";a.r(t);a(180);var n=a(0),r=a.n(n),c=a(59),s=a.n(c),i=a(33),l=a(34),o=a(37),u=a(35),p=a(36),h=a(8),d=a(25),f="GET_CONFIG",m="GET_FACETS",g="GET_LOADING_DATA_REQUEST",b="GET_DATA_REQUEST",v="GET_SEARCH_TEXT",y="GET_FILTERS";function E(e){return{type:f,payload:{config_data:e}}}function _(e){return{type:m,payload:{search_facets:e}}}function O(e){return{type:g,payload:{text:e}}}function k(e,t){return{type:b,payload:{text:e,data:t}}}function j(e){return{type:v,payload:{text:e}}}var C=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).searchInput=r.a.createRef(),a.search=a.search.bind(Object(h.a)(Object(h.a)(a))),a.searchOnKeyPress=a.searchOnKeyPress.bind(Object(h.a)(Object(h.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"search",value:function(){this.props.getSearchTextAction(this.searchInput.current.value),this.props.searchForData(this.searchInput.current.value,this.props.filters.filters)}},{key:"searchOnKeyPress",value:function(e){13===e.keyCode&&(this.props.getSearchTextAction(this.searchInput.current.value),this.props.searchForData(this.searchInput.current.value,this.props.filters.filters))}},{key:"render",value:function(){return r.a.createElement("div",{className:"search-block"},r.a.createElement("input",{type:"text",placeholder:"Enter the key words...",ref:this.searchInput,onKeyDown:this.searchOnKeyPress,className:this.props.data.is_loading?"disabled":""}),r.a.createElement("button",{onClick:this.search,className:"search-btn ".concat(this.props.data.is_loading?"disabled":"")},this.props.data.is_loading?r.a.createElement(r.a.Fragment,null,"Searching",r.a.createElement("div",{className:"lds-spinner"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null))):r.a.createElement(r.a.Fragment,null,"Search")))}}]),t}(r.a.Component),N=Object(d.b)(function(e){return{data:e.data,filters:e.filters}},function(e){return{getSearchTextAction:function(t){return e(j(t))}}})(C),A=a(178),D=a(172),w=a.n(D),F=a(173),S=a(38),R=function(e){var t=e.item,a=e.portals;return r.a.createElement("div",{className:"result-item"},r.a.createElement("h3",null,r.a.createElement("a",{href:void 0!==t.organization?a.ckan+"/dataset/"+t.id:a.drupal+"/node/"+t.id},t.title)),r.a.createElement("p",{className:"result-date"},t.thematic_area_string[0]?r.a.createElement("span",{className:"topic-title"},t.thematic_area_string.join(", ")):"",r.a.createElement(w.a,{format:"D MMMM YYYY"},t.metadata_modified)),void 0!==t.five_star_rating&&0!==t.five_star_rating?r.a.createElement("span",{className:"star-rating"},Object(A.a)(Array(t.five_star_rating).keys()).map(function(e){return r.a.createElement(S.a,{icon:"star",key:"star-".concat(e+1)})})):"",r.a.createElement("span",{className:"result-type"}," ",t.type.replace("_"," ")),r.a.createElement("p",{className:"note"},r.a.createElement(F.a,{lines:3,ellipsis:"..."},t.notes)),t.resources?r.a.createElement("div",{className:"resources-list"},t.resources.map(function(e){return r.a.createElement("span",{className:"resource",key:e.id},""!==e.format?e.format:"DATA")})):"")},T=a(43),x=a.n(T),I=a(90),P=function(e){return I.a.DropdownIndicator&&r.a.createElement(I.a.DropdownIndicator,e,r.a.createElement(S.a,{icon:e.selectProps.menuIsOpen?"caret-up":"caret-down"}))},L=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={options:[],selectedOption:null},a.handleChange=a.handleChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=[];this.props.facets.search_facets[this.props.facet_key].items.forEach(function(t){e.push({value:t.name,label:t.display_name+" ("+t.count+")"})}),this.setState({options:e})}},{key:"componentDidUpdate",value:function(e){if(this.props.facets.search_facets!==e.facets.search_facets){var t=[];this.props.facets.search_facets[this.props.facet_key].items.forEach(function(e){t.push({value:e.name,label:e.display_name+" ("+e.count+")"})}),this.setState({options:t})}}},{key:"handleChange",value:function(e){this.props.get_filters(this.props.facet_key,e),this.setState({selectedOption:e})}},{key:"render",value:function(){return r.a.createElement(I.b,{value:this.state.selectedOption,onChange:this.handleChange,options:this.state.options,placeholder:"Select a ".concat(this.props.facet_key.replace("_"," ")),isMulti:!0,closeMenuOnSelect:!0,className:"filter-select ".concat(this.props.data.is_loading||"language"===this.props.facet_key?"disabled":""),classNamePrefix:"filter",components:{DropdownIndicator:P}})}}]),t}(r.a.Component),M=Object(d.b)(function(e){return{data:e.data,facets:e.facets}},function(e){return{getFacetsAction:function(t){return e(_(t))}}})(L),U=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).initalSearch=a.initalSearch.bind(Object(h.a)(Object(h.a)(a))),a.get_filters=a.get_filters.bind(Object(h.a)(Object(h.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.config.config_data!==e.config.config_data&&this.initalSearch()}},{key:"initalSearch",value:function(e){var t=this,a=this.props.config.config_data;x.a.all(a.portals.map(function(e){var t={};return"ckan"===e.portal.toLowerCase()?t={"facet.field":'["organization", "tags", "res_format", "license_id", "type", "member_countries", "topic", "language"]',rows:0}:"drupal"===e.portal.toLowerCase()&&(t={topic:""}),x.a.get(e.url+e.endpoint,{params:t})})).then(x.a.spread(function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];t.props.getResponseData(a,!0)})).catch(function(e){console.log(e)}).then(function(a){t.props.getDataAction(e,a)})}},{key:"get_filters",value:function(e,t){var a=this.props.filters.filters;0!==t.length?a[e]=t:void 0!==a[e]&&delete a[e],this.props.getFiltersAction(a),(Object.keys(a).length>0||0===Object.keys(a).length&&void 0!==this.props.data.text)&&this.props.searchForData(this.props.data.text,a),0===Object.keys(a).length&&void 0===this.props.data.text&&this.initalSearch("")}},{key:"render",value:function(){var e=this,t=this.props.facets;return r.a.createElement("div",{className:"filter-block"},r.a.createElement("p",null,"Filter your search"),r.a.createElement("div",{className:"advanced-search-filters"},Object.keys(t).map(function(t){return r.a.createElement(M,{facet_key:t,get_filters:e.get_filters,key:t})})))}}]),t}(r.a.Component),G=Object(d.b)(function(e){return{config:e.config,facets:e.facets.search_facets,data:e.data,filters:e.filters}},function(e){return{getConfigAction:function(t){return e(E(t))},getFacetsAction:function(t){return e(_(t))},getSearchTextAction:function(t){return e(j(t))},isLoadingAction:function(t){return e(O(t))},getFiltersAction:function(t){return e({type:y,payload:{filters:t}})},getDataAction:function(t,a){return e(k(t,a))}}})(U),K=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).state={currentPage:1},a.getRenderResults=a.getRenderResults.bind(Object(h.a)(Object(h.a)(a))),a.getPagination=a.getPagination.bind(Object(h.a)(Object(h.a)(a))),a.handleClick=a.handleClick.bind(Object(h.a)(Object(h.a)(a))),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.results!==e.results&&this.setState({currentPage:1})}},{key:"getRenderResults",value:function(){var e=this,t=this.props.config.config_data.results_per_page,a=this.state.currentPage*t,n=a-t;return this.props.results.results.slice(n,a).map(function(t){return r.a.createElement(R,{item:t,key:t.id,portals:e.props.portals})})}},{key:"getPagination",value:function(){var e=this.props.config.config_data.results_per_page,t=parseInt(Math.ceil(this.props.results.count/e),10),a=this.state.currentPage;return r.a.createElement("ul",{className:"search-pagination"},a>1?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{onClick:this.handleClick,page:"1"},r.a.createElement(S.a,{icon:"angle-double-left"})),r.a.createElement("li",{onClick:this.handleClick,page:a-1},r.a.createElement(S.a,{icon:"angle-left"})),r.a.createElement("li",{onClick:this.handleClick,page:a-1},a-1)):r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:"disabled"},r.a.createElement(S.a,{icon:"angle-left"}))),r.a.createElement("li",{className:"active",onClick:this.handleClick,page:a},a),t-a>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{onClick:this.handleClick,page:a+1},a+1),t>a+1&&r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:"disabled"},"..."),r.a.createElement("li",{onClick:this.handleClick,page:t},t)),r.a.createElement("li",{onClick:this.handleClick,page:a+1},r.a.createElement(S.a,{icon:"angle-right"})),r.a.createElement("li",{onClick:this.handleClick,page:t},r.a.createElement(S.a,{icon:"angle-double-right"}))))}},{key:"handleClick",value:function(e){this.setState({currentPage:parseInt(e.target.getAttribute("page"),10)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"results-list"},this.props.results?this.props.results.count>0?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},this.props.results.count," Results Found"),this.props.results.types_count?Object.keys(this.props.results.types_count).map(function(t,a){return r.a.createElement("span",{key:t},e.props.results.types_count[t]," ",t.replace("_"," "),Object.keys(e.props.results.types_count).length-1>a?", ":"")}):""),r.a.createElement("div",{className:"result-content datasets-list"},this.getRenderResults(),this.props.results.count>this.props.config.config_data.results_per_page?this.getPagination():"")):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},"No Results Found"),r.a.createElement("p",{className:"small"},"Sorry, we couldn\u2019t found any results matching your search")),r.a.createElement("div",{className:"result-content"},r.a.createElement("p",null,"Suggestions:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Make sure all words are spelled correctly"),r.a.createElement("li",null,"Try a similar but different search term"),r.a.createElement("li",null,"The filter combination may return zero results, you may have to try a different search scope")))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"result-info"},r.a.createElement("p",{className:"result-title"},"What are you looking for?")),r.a.createElement("div",{className:"result-content"},r.a.createElement("ul",null,r.a.createElement("li",null,"Start your search by typing one or more keywords into the search box"),r.a.createElement("li",null,"Using general search terms will get more search results, or use exact phrases to narrow down your search"),r.a.createElement("li",null,"For more specific results, make use of the filters to limit your search scope")))))}}]),t}(r.a.Component),q=Object(d.b)(function(e){return{config:e.config}})(K),z=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).getResponseData=a.getResponseData.bind(Object(h.a)(Object(h.a)(a))),a.searchForData=a.searchForData.bind(Object(h.a)(Object(h.a)(a))),a.portalsUrls={},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this,t=window.advanced_search_conf_url?window.advanced_search_conf_url:"";x.a.get(t+"/configs/config.json").then(function(t){e.props.getConfigAction(t.data)}).catch(function(e){console.log(e)})}},{key:"getResponseData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[],n=0,r={},c=0,s={},i={items:[],title:"topic"},l={};if(e.forEach(function(e){if(Object.keys(e.data.result.search_facets).forEach(function(t){"topic"===t?e.data.result.search_facets[t].items.forEach(function(e){void 0===l[e.name]?l[e.name]=e:l[e.name].count=l[e.name].count+e.count}):s[t]=e.data.result.search_facets[t]}),!0!==t&&e.data.result&&(a=a.concat(e.data.result.results),n+=e.data.result.count,e.data.result.types_count))if(r=e.data.result.types_count,Object.keys(r).length>1)c=Object.keys(r).reduce(function(e,t){return r[e]+r[t]});else{var i=Object.keys(r)[0];c=r[i]}}),Object.keys(l).forEach(function(e){i.items.push(l[e])}),s.topic=i,Object.keys(s).length>0){var o={};Object.keys(s).sort().forEach(function(e){o[e]=s[e]}),this.props.getFacetsAction(o)}var u=n-c;return u>0&&(r.story=u),{count:n,results:a,types_count:r}}},{key:"searchForData",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.props.isLoadingAction(!0);var n="";a&&Object.keys(a).forEach(function(e){var t=[];a[e].forEach(function(e){t.push(e.value)}),t.length>1?n+=e+':["'+t.join('", "')+'"]':n+=e+':"'+t[0]+'"'});var r=this.props.config.config_data;x.a.all(r.portals.map(function(r){t.portalsUrls[r.portal]=r.url;var c={};return"ckan"===r.portal.toLowerCase()?(c={"facet.field":'["organization", "tags", "res_format", "license_id", "type", "member_countries", "topic", "language"]'},""!==e&&(c.q=e),""!==n&&(c.fq=n)):"drupal"===r.portal.toLowerCase()&&a&&((Object.keys(a).length>1||1===Object.keys(a).length&&(void 0===a.topic||a.topic.length>1))&&(c={disabled:!0}),1===Object.keys(a).length&&void 0!==a.topic&&1===a.topic.length&&(""!==e&&(c.query=e),c.topic=a.topic[0].value),0===Object.keys(a).length&&""!==e&&(c.query=e)),x.a.get(r.url+r.endpoint,{params:c})})).then(x.a.spread(function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return t.getResponseData(a)})).catch(function(e){console.log(e),t.props.isLoadingAction(!1)}).then(function(a){t.props.getDataAction(e,a)})}},{key:"render",value:function(){return r.a.createElement("div",{className:"advanced-search"},r.a.createElement(N,{searchForData:this.searchForData}),r.a.createElement(G,{searchForData:this.searchForData,getResponseData:this.getResponseData}),r.a.createElement(q,{results:this.props.data.data,portals:this.portalsUrls}))}}]),t}(n.Component),Y=Object(d.b)(function(e){return{data:e.data,config:e.config,facets:e.facets}},function(e){return{getConfigAction:function(t){return e(E(t))},getFacetsAction:function(t){return e(_(t))},isLoadingAction:function(t){return e(O(t))},getDataAction:function(t,a){return e(k(t,a))}}})(z),B=a(64),J=a(60),Q={config_data:{}},W={search_facets:{}},H={text:"",is_loading:!1,data:null},X={filters:{}};var V=Object(B.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(J.a)({},e,{config_data:t.payload.config_data});default:return e}},facets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return Object(J.a)({},e,{search_facets:t.payload.search_facets});default:return e}},data:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(J.a)({},e,{text:t.payload.text,is_loading:!1,data:t.payload.data});case g:return Object(J.a)({},e,{is_loading:!0});case v:return Object(J.a)({},e,{text:t.payload.text});default:return e}},filters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(J.a)({},e,{filters:t.payload.filters});default:return e}}}),Z=Object(B.c)(V),$=(a(428),a(71)),ee=a(51);$.b.add([ee.g,ee.e,ee.f,ee.a,ee.c,ee.d,ee.b]),document.getElementById("advanced-search-application")&&s.a.render(r.a.createElement(d.a,{store:Z},r.a.createElement(Y,null)),document.getElementById("advanced-search-application"))}},[[179,2,1]]]);
